<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Status Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        /* CSS Styles */
        :root {
            --primary-color: #1976d2;
            --primary-dark: #1565c0;
            --background: #fafafa;
            --surface: #ffffff;
            --on-surface: #212121;
            --on-surface-variant: #757575;
            --outline: #e0e0e0;
            
            /* Navbar Specific Colors (Light Mode) */
            --nav-bg: #ffffff;
            --nav-text: #212121;
            --nav-border: #e0e0e0;

            --status-online: #4caf50;
            --status-offline: #9e9e9e;
            --status-busy: #ff5722;
            --status-full: #9c27b0;
            --ping-good: #4caf50;
            --ping-medium: #ff9800;
            --ping-bad: #f44336;
            --elevation-1: 0 1px 3px rgba(0,0,0,0.12);
        }

        .dark-theme {
            --background: #121212;
            --surface: #1e1e1e;
            --on-surface: #ffffff;
            --on-surface-variant: #b0b0b0;
            --outline: #333333;

            /* Navbar Specific Colors (Dark Mode) */
            --nav-bg: #1e1e1e;
            --nav-text: #ffffff;
            --nav-border: #333333;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Roboto', sans-serif; background-color: var(--background); color: var(--on-surface); transition: background-color 0.3s; min-height: 100vh; }
        
        /* --- Navbar Customization Start --- */
        .navbar {
            background-color: var(--nav-bg) !important;
            border-bottom: 1px solid var(--nav-border);
            transition: background-color 0.3s, border-color 0.3s;
        }
        
        .navbar-brand { 
            font-weight: 600; 
            color: var(--primary-color) !important; 
            display: flex; 
            align-items: center; 
            gap: 8px; 
        }
        
        /* Nav Links Color */
        .navbar-nav .nav-link { 
            color: var(--nav-text) !important; 
            font-weight: 500; 
            transition: color 0.3s;
        }
        
        .navbar-nav .nav-link:hover,
        .navbar-nav .nav-link.active {
            color: var(--primary-color) !important;
        }

        /* Fix Hamburger Menu Icon in Dark Mode */
        .dark-theme .navbar-toggler {
            border-color: rgba(255,255,255,0.5);
        }
        .dark-theme .navbar-toggler-icon {
            filter: invert(1); /* Invert black icon to white */
        }
        /* --- Navbar Customization End --- */
        
        .container { max-width: 800px; margin: 0 auto; padding: 16px; }

        .stats-card {
            background: var(--surface);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--elevation-1);
            text-align: center;
            transition: background-color 0.3s;
        }
        .total-users-count { font-size: 48px; font-weight: 700; color: var(--primary-color); line-height: 1; margin: 10px 0; }
        .total-users-label { color: var(--on-surface-variant); font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }

        .server-list { background: var(--surface); border-radius: 16px; overflow: hidden; box-shadow: var(--elevation-1); transition: background-color 0.3s; }
        .server-list-header { background: var(--primary-color); color: white; padding: 15px 20px; font-weight: 500; display: flex; align-items: center; gap: 10px; }
        
        .server-item { padding: 15px 20px; border-bottom: 1px solid var(--outline); transition: border-color 0.3s; }
        .server-item:last-child { border-bottom: none; }
        
        .server-top-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .server-name-group { display: flex; align-items: center; gap: 10px; }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; }
        .flag-icon { width: 24px; height: 18px; border-radius: 3px; object-fit: cover; }
        .server-name-text { font-weight: 500; font-size: 16px; }
        
        .ping-badge { padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; color: white; }
        .ping-good { background-color: var(--ping-good); }
        .ping-medium { background-color: var(--ping-medium); }
        .ping-bad { background-color: var(--ping-bad); }

        .progress-area { margin-top: 8px; }
        .progress-info { display: flex; justify-content: space-between; font-size: 12px; color: var(--on-surface-variant); margin-bottom: 4px; }
        .progress { height: 6px; background-color: var(--outline); border-radius: 3px; overflow: hidden; }
        .progress-bar { height: 100%; transition: width 0.5s ease; }

        /* Retry Button */
        .retry-btn { background: none; border: 1px solid var(--outline); color: var(--on-surface-variant); padding: 4px 12px; border-radius: 15px; font-size: 12px; cursor: pointer; }
        
        /* Floating Theme Button */
        .fab { position: fixed; bottom: 20px; right: 20px; width: 50px; height: 50px; background: var(--primary-color); color: white; border: none; border-radius: 50%; box-shadow: 0 4px 10px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 100; transition: transform 0.2s; }
        .fab:hover { transform: scale(1.1); }

        /* Loading Animation */
        .skeleton { background: linear-gradient(90deg, var(--outline) 25%, var(--background) 50%, var(--outline) 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; border-radius: 4px; height: 1em; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <img src="https://raw.githubusercontent.com/sansoe2022/image_store/refs/heads/main/icon.png" alt="SVPN Logo" style="width:36px; height:auto;">
                Server status
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#svpnNavbar" aria-controls="svpnNavbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="svpnNavbar">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="guidesim.html">
                            <i class="bi bi-journal-code me-1"></i> VPN နဲ့ ချိတ်သုံးဖို့ လမ်းညွှန်
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="extendsim.html">
                            <i class="bi bi-phone me-1"></i> ဆင်းမ်ကဒ် သက်တမ်းတိုးနည်း
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="index.html">
                            <i class="bi bi-house-door me-1"></i> Home
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="stats-card">
            <div class="total-users-label">Total Online Users</div>
            <div class="total-users-count" id="totalOnlineCount">--</div>
            <div style="font-size: 12px; color: var(--status-online);">
                <i class="bi bi-circle-fill" style="font-size: 8px;"></i> Live Updates
            </div>
        </div>

        <div class="server-list">
            <div class="server-list-header">
                <i class="bi bi-hdd-rack"></i> Server List
            </div>
            <div id="serverContainer">
                </div>
        </div>
        
        <div class="text-center mt-3" style="font-size: 12px; color: var(--on-surface-variant);">
            <span id="lastUpdated">Updating...</span>
        </div>
    </div>

    <button class="fab" id="themeToggle"><i class="bi bi-moon-fill"></i></button>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // --- Server Configurations ---
        const servers = [
            
            { 
                id: 'us-01', 
                name: 'US-01', 
                urls: [
                    'http://svpnus.sksvpn.shop:81/server/online',
                    'http://svpnus.sksvpn.shop:81/udpserver/online'
                ] 
            },
            { 
                id: 'sg-01', 
                name: 'Singapore-01', 
                urls: [
                    'http://svpnsg1.sksvpn.shop:81/server/online',
                    'http://svpnsg1.sksvpn.shop:81/udpserver/online'
                ] 
            },
            { 
                id: 'th-01', 
                name: 'Thailand-01', 
                urls: [
                    'http://svpnfree1dec.sksvpn.shop:81/server/online',
                    'http://svpnfree1dec.sksvpn.shop:81/udpserver/online'
                ] 
            },
            { 
                id: 'th-02', 
                name: 'Thailand-02', 
                urls: [
                    'http://svpnfree2dec.sksvpn.shop:81/server/online',
                    'http://svpnfree2dec.sksvpn.shop:81/udpserver/online'
                ] 
            },
            { 
                id: 'th-03', 
                name: 'Thailand-03', 
                urls: [
                    'http://svpnfree3dec.sksvpn.shop:81/server/online',
                    'http://svpnfree3dec.sksvpn.shop:81/udpserver/online'
                ] 
            },
            { 
                id: 'th-04', 
                name: 'Thailand-04', 
                urls: [
                    'http://svpnfree4jan.sksvpn.shop:81/server/online',
                    'http://svpnfree4jan.sksvpn.shop:81/udpserver/online'
                ] 
            },
            { 
                id: 'th-05', 
                name: 'Thailand-05', 
                urls: [
                    'http://svpnfree4jan.sksvpn.shop:8888/server/online',
                    'http://svpnfree4jan.sksvpn.shop:88888/udpserver/online'
                ] 
            },
            { 
                id: 'th-06', 
                name: 'Thailand-06', 
                urls: [
                    'http://svpnfree6jan.sksvpn.shop:81/server/online',
                    'http://svpnfree6jan.sksvpn.shop:81/udpserver/online'
                ] 
            },
            { 
                id: 'th-07', 
                name: 'Thailand-07', 
                urls: [
                    'http://svpnfree7jan.sksvpn.shop:8888/server/online',
                    'http://svpnfree7jan.sksvpn.shop:88888/udpserver/online'
                ] 
            }
        ];

        const SERVER_USER_LIMIT = 250;
        
        // CORS Proxies
        const corsProxies = [
            url => `https://corsproxy.io/?${encodeURIComponent(url)}`, 
            url => `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`
        ];

        // --- UI Helpers ---
        function getFlag(id) {
            return `https://flagcdn.com/w40/${id.split('-')[0] || 'th'}.png`;
        }

        // --- Main Logic ---
        async function fetchUrlWithProxy(url) {
            for (const proxyGen of corsProxies) {
                try {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 5000); 
                    
                    const response = await fetch(proxyGen(url), { 
                        signal: controller.signal,
                        headers: { 'Cache-Control': 'no-cache' }
                    });
                    clearTimeout(timeoutId);
                    
                    if (response.ok) return await response.text();
                } catch (e) {
                    continue; 
                }
            }
            throw new Error("All proxies failed");
        }

        async function updateDashboard() {
            const container = document.getElementById('serverContainer');
            const totalEl = document.getElementById('totalOnlineCount');
            
            if(container.children.length === 0) {
                container.innerHTML = servers.map(s => `
                    <div class="server-item" id="row-${s.id}">
                        <div class="d-flex align-items-center gap-2">
                            <div class="skeleton" style="width: 24px; height: 24px; border-radius: 50%;"></div>
                            <div class="skeleton" style="width: 100px;"></div>
                        </div>
                        <div class="skeleton mt-2" style="width: 100%; height: 6px;"></div>
                    </div>
                `).join('');
            }

            let globalTotal = 0;

            const promises = servers.map(async (server) => {
                const rowId = `row-${server.id}`;
                let rowEl = document.getElementById(rowId);
                if (!rowEl) return; 

                try {
                    const results = await Promise.allSettled(server.urls.map(u => fetchUrlWithProxy(u)));
                    
                    let onlineCount = 0;
                    let isOnline = false;

                    results.forEach(res => {
                        if(res.status === 'fulfilled') {
                            const num = parseInt(res.value, 10);
                            if(!isNaN(num)) {
                                onlineCount += num;
                                isOnline = true;
                            }
                        }
                    });

                    if (!isOnline) throw new Error("Offline");

                    if (onlineCount > SERVER_USER_LIMIT) onlineCount = SERVER_USER_LIMIT;
                    globalTotal += onlineCount;

                    const fakePing = Math.floor(Math.random() * (120 - 45 + 1) + 45); 
                    const percent = Math.round((onlineCount / SERVER_USER_LIMIT) * 100);
                    
                    let statusColor = 'var(--status-online)';
                    let badgeClass = 'ping-good';
                    if(percent > 90) { statusColor = 'var(--status-full)'; badgeClass = 'ping-bad'; }
                    else if(percent > 70) { statusColor = 'var(--status-busy)'; badgeClass = 'ping-medium'; }

                    rowEl.innerHTML = `
                        <div class="server-top-row">
                            <div class="server-name-group">
                                <div class="status-dot" style="background-color: ${statusColor}; box-shadow: 0 0 5px ${statusColor};"></div>
                                <img src="${getFlag(server.id)}" class="flag-icon">
                                <span class="server-name-text">${server.name}</span>
                            </div>
                            <div class="ping-badge ${badgeClass}">
                                <i class="bi bi-activity"></i> ${fakePing}ms
                            </div>
                        </div>
                        <div class="progress-area">
                            <div class="progress-info">
                                <span>${onlineCount} / ${SERVER_USER_LIMIT} Users</span>
                                <span>${percent}%</span>
                            </div>
                            <div class="progress">
                                <div class="progress-bar" style="width: ${percent}%; background-color: ${statusColor};"></div>
                            </div>
                        </div>
                    `;

                } catch (error) {
                    rowEl.innerHTML = `
                        <div class="server-top-row">
                            <div class="server-name-group">
                                <div class="status-dot" style="background-color: var(--status-offline);"></div>
                                <img src="${getFlag(server.id)}" class="flag-icon" style="filter: grayscale(1);">
                                <span class="server-name-text" style="color: var(--on-surface-variant);">${server.name}</span>
                            </div>
                            <button class="retry-btn" onclick="location.reload()">Offline</button>
                        </div>
                    `;
                }
            });

            await Promise.allSettled(promises);
            totalEl.textContent = globalTotal;
            
            const now = new Date();
            document.getElementById('lastUpdated').innerText = 'Last updated: ' + now.toLocaleTimeString('en-US', { hour12: false });
        }

        // Theme Logic
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = themeToggle.querySelector('i');
        const body = document.body;
        
        // Function to update icon
        function updateThemeIcon(isDark) {
            themeIcon.className = isDark ? 'bi bi-sun-fill' : 'bi bi-moon-fill';
        }

        // Check saved theme
        if(localStorage.getItem('theme') === 'dark') {
            body.classList.add('dark-theme');
            updateThemeIcon(true);
        }
        
        themeToggle.addEventListener('click', () => {
            body.classList.toggle('dark-theme');
            const isDark = body.classList.contains('dark-theme');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            updateThemeIcon(isDark);
        });

        updateDashboard();
        setInterval(updateDashboard, 20000); 
    </script>
</body>
</html>
